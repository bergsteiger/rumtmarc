: K382410422

: "Проверить, что вкладка на форме придочена в дерево терминов ТС"  STRING IN aControl STRING IN aForm

 "Перевести фокус в {(aControl)} на форме {(aForm)}"
 OBJECT VAR "Текущий контрол"
 focused:control:push =: "Текущий контрол"
 OBJECT VAR "Навигатор"
 "Текущий контрол" 2 раза pop:control:GetAnotherParentForm =: "Навигатор"
 "Навигатор" pop:object:IsNil ! 'Не нашли форму' ASSERTS
 OBJECT VAR "Неотдоченный левый навигатор"
 "Найти контрол {(контрол::UnderControlList)} на форме {("Навигатор")}" >>> "Неотдоченный левый навигатор"
 "Неотдоченный левый навигатор" pop:object:IsNil ! 'Навигатора в списке терминов нет!' ASSERTS
; // "Проверить, что вкладка на форме придочена в дерево терминов ТС"

  : "Перетащить отдоченную вкладку Документов на контроле в список терминов ТС"
   : Сохраняем_позицию_мыши
    "Открыть вкладку Документы на контроле"
    "Сделать вкладку {(контрол::UnderControlList)} на форме {(форма::UnderControl)} плавающей"
    "Дать системе перерисоваться"
    "Установить курсор мыши по координатам {(50 -70)} относительно контрола {(focused:control:push)}" // на заголовок отдоченной вкладки
    "Перевести фокус в дерево терминов"
    THREAD ( 1500 SLEEP 
    "Установить курсор мыши по координатам {(5 220)} относительно контрола {("Найти главное окно")}"  // в ЛЕВУЮ часть списка терминов
    "Отпустить левую кнопку мыши" )
    "Зажать левую кнопку мыши"
    "Дать системе перерисоваться"
    3000 SLEEP
   ; // Сохраняем_позицию_мыши
  "Запомнить позицию мыши и выполнить {(@ Сохраняем_позицию_мыши )}"
 ;  // "Перетащить отдоченную вкладку Документов на контроле в список терминов ТС"

  : "Вытащить вкладку Документов на контроле в область текста термина ТС"
   : Снова_сохраняем_позицию_мыши
     "Установить курсор мыши по координатам {(5 144)} относительно контрола {("Найти главное окно")}"  // на заголовок вкладки
     THREAD ( 3500 SLEEP 
     "Установить курсор мыши по координатам {(350 0 )} относительно контрола {(focused:control:push)}" // в текст термина
     "Отпустить левую кнопку мыши" )
     "Зажать левую кнопку мыши"
     4000 SLEEP 
    ; // Снова_сохраняем_позицию_мыши
   "Запомнить позицию мыши и выполнить {(@ Снова_сохраняем_позицию_мыши )}"
  ;  // "Вытащить вкладку Документов на контроле в область текста термина ТС"

  : Сохраняем_размеры
   : Ждем_ассерт 
    "Найти главное окно" "Развернуть окно"
    "Восстановить все настройки текущей конфигурации"
    "Толковый словарь"
    "Закрыть форму БП"
    "Перетащить отдоченную вкладку Документов на контроле в список терминов ТС"
    "Проверить, что вкладка {(контрол::UnderControlList)} на форме {(форма::UnderControl)} придочена в дерево терминов ТС"  
    "Вытащить вкладку Документов на контроле в область текста термина ТС"
   ; // Ждем_ассерт
   Ждем_ассерт

  ; // Сохраняем_размеры 
 TRY 
  "Сделать {(@ Сохраняем_размеры )} с изменением состояния и размеров окна {("Найти главное окно")}"
 FINALLY
  ОМ
  "Открыть вкладку Документы на контроле"
  "Сделать вкладку {(контрол::UnderControlList)} на форме {(форма::UnderControl)} неплавающей"
  "Закрыть текущую вкладку"
  // пытаемся бороться с мусором (из-за того, что вкладка может быть отдочена)
  "Восстановить все настройки текущей конфигурации"
  "Закрыть вкладку Документы на контроле"
 END
;

анти-тест K382410422
