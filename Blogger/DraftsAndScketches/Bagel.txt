<div dir="ltr" style="text-align: left;" trbidi="on">
Вот тут -&nbsp;<a href="http://roman.yankovsky.me/?p=1100">http://roman.yankovsky.me/?p=1100</a><br />
<br />
Комментарий:<br />
"Идея здравая, понравилось, только каждый раз дергать создание нити имхо чересчур, можно наверное что-то наподобие пула прикрутить.<br />
<br />
Далее, к примеру результатом должен возвращаться некий объект (тот-же TObject), здесь мы имеем огромный шанс получить мемлик.<br />
Я бы переделал немного так: при вызове метода TAwaitable.Value: T; выставлять флаг, мол объект передан наружу и в деструкторе проверять этот флаг.<br />
Если созданный объект не потребовался, разрушить его (ну как-то так, сумбурно…)"<br />
<br />
Вот это - "только каждый раз дергать создание нити имхо чересчур, можно наверное что-то наподобие пула прикрутить." - БОЛЕЕ ЧЕМ "по делу". Тут - СОГЛАСЕН на все 100%.<br />
<br />
А вот тут - "Далее, к примеру результатом должен возвращаться некий объект (тот-же TObject), здесь мы имеем огромный шанс получить мемлик.<br />
Я бы переделал немного так: при вызове метода TAwaitable.Value: T; выставлять флаг, мол объект передан наружу и в деструкторе проверять этот флаг.<br />
Если созданный объект не потребовался, разрушить его (ну как-то так, сумбурно…)"<br />
<br />
-- скажем так - "смущён"... "флаг"... проверка "флага в деструкторе"...<br />
<br />
"смущён"...<br />
<br />
КРИТИКОВАТЬ - НЕ ИМЕЮ ПРАВА...<br />
<br />
Но "мне кажется", что есть много разных "техник" для разрешения этого "конфликта" или Owned-Component, или ARC, ну или "на худой конец" - подсчёт ссылок (<a href="http://18delphi.blogspot.ru/2013/05/blog-post_8702.html">http://18delphi.blogspot.ru/2013/05/blog-post_8702.html</a>&nbsp;или&nbsp;<a href="http://18delphi.blogspot.ru/2013/04/iunknown.html">http://18delphi.blogspot.ru/2013/04/iunknown.html</a>&nbsp;или&nbsp;<a href="http://18delphi.blogspot.ru/2013/03/blog-post_4606.html">http://18delphi.blogspot.ru/2013/03/blog-post_4606.html</a>).</div>
